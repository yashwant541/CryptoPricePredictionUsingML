import os
from pdf2image import convert_from_path
import easyocr
from docx import Document

# ----------------------------------------------------------
# ğŸ”§ User Configuration
# ----------------------------------------------------------
input_folder = r"C:\path\to\input_pdfs"     # ğŸ“¥ Folder with scanned PDFs
output_folder = r"C:\path\to\output_texts"  # ğŸ“¤ Folder for extracted text
os.makedirs(output_folder, exist_ok=True)

# ----------------------------------------------------------
# ğŸ§  Initialize OCR reader
# ----------------------------------------------------------
reader = easyocr.Reader(['en'], gpu=False)  # Set gpu=True if you have GPU

# ----------------------------------------------------------
# ğŸ” Process each PDF
# ----------------------------------------------------------
for filename in os.listdir(input_folder):
    if filename.lower().endswith(".pdf"):
        pdf_path = os.path.join(input_folder, filename)
        base_name = os.path.splitext(filename)[0]
        print(f"ğŸ” Processing: {filename}")

        # Convert each page to image
        pages = convert_from_path(pdf_path, dpi=300)

        full_text = ""
        for page_num, page in enumerate(pages, start=1):
            print(f"   ğŸ“„ OCR on page {page_num}/{len(pages)}...")
            results = reader.readtext(page, detail=0)
            page_text = "\n".join(results)
            full_text += f"\n--- Page {page_num} ---\n{page_text}\n"

        # ----------------------------------------------------------
        # ğŸ’¾ Save as .txt
        # ----------------------------------------------------------
        txt_path = os.path.join(output_folder, f"{base_name}.txt")
        with open(txt_path, "w", encoding="utf-8") as f:
            f.write(full_text)
        print(f"   âœ… Saved text: {txt_path}")

        # ----------------------------------------------------------
        # ğŸ’¾ Save as .docx
        # ----------------------------------------------------------
        doc = Document()
        doc.add_paragraph(full_text)
        docx_path = os.path.join(output_folder, f"{base_name}.docx")
        doc.save(docx_path)
        print(f"   âœ… Saved Word: {docx_path}\n")

print("ğŸ¯ All PDFs processed successfully!")
