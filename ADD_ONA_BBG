import os
import extract_msg
import shutil

# Define your input and output folders
msg_folder = r"C:\Users\2011747\Desktop\Benchmark HKIN\New Inputs\Independent Sources - RFI\MIBOR TM\MIBOR TM"
output_folder = r"C:\Users\2011747\Desktop\Benchmark HKIN\New Inputs\Independent Sources - RFI\MIBOR TM\Mibor TM Attachments"
os.makedirs(output_folder, exist_ok=True)

# Loop through all .msg files in the msgfiles folder
for filename in os.listdir(msg_folder):
    if filename.lower().endswith(".msg"):
        msg_path = os.path.join(msg_folder, filename)
        msg = extract_msg.Message(msg_path)
        for att in msg.attachments:
            att_name = att.longFilename or att.shortFilename
            if att_name and att_name.lower().endswith((".xlsx", ".xlsm", ".csv")):
                save_path = os.path.join(output_folder, att_name)
                with open(save_path, "wb") as f:
                    f.write(att.data)
                print(f"Saved {att_name} from {filename} to {output_folder}")
