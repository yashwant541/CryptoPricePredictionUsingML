import dataiku
import pandas as pd
import os
import tempfile

# ------------------------------------------------------
# ğŸ”§ Configuration â€” Replace with your Dataiku folder IDs
# ------------------------------------------------------
input_folder = dataiku.Folder("INPUT_FOLDER_ID")   # ğŸ“¥ Input folder
output_folder = dataiku.Folder("OUTPUT_FOLDER_ID") # ğŸ“¤ Output folder

# ------------------------------------------------------
# ğŸ§¾ Read the file "Filename.csv" from input folder
# ------------------------------------------------------
input_path = os.path.join(input_folder.get_path(), "Filename.csv")

df = pd.read_csv(input_path, dtype=str)  # read as string to preserve all text exactly

# ------------------------------------------------------
# ğŸ§® Split "Tenor" into "Type" and "Tenure"
# ------------------------------------------------------
if "Tenor" not in df.columns:
    raise ValueError("âŒ Column 'Tenor' not found in the input file.")

# Keep rightmost 2 characters as 'Tenure'
df["Tenure"] = df["Tenor"].astype(str).str[-2:]

# Remaining text (excluding the rightmost 2 chars)
df["Type"] = df["Tenor"].astype(str).str[:-2]

# Remove the subset 'VOL' from Type
df["Type"] = df["Type"].str.replace("VOL", "", regex=False).str.strip()

# ------------------------------------------------------
# ğŸ’¾ Write to output folder
# ------------------------------------------------------
output_filename = "Processed_Filename.csv"
temp_output_path = os.path.join(tempfile.gettempdir(), output_filename)

df.to_csv(temp_output_path, index=False, encoding="utf-8-sig")

# Write file to Dataiku output folder
output_folder.upload_file(output_filename, temp_output_path)

print(f"âœ… Successfully processed and saved: {output_filename}")
