import os
from docx import Document
import pandas as pd
from pathlib import Path

def extract_tables_from_docx(docx_path):
    """Extract tables from a Word document while preserving special characters."""
    doc = Document(docx_path)
    tables = []

    for table in doc.tables:
        table_data = []
        for row in table.rows:
            row_data = []
            for cell in row.cells:
                # Preserve newlines and special characters
                cell_text = cell.text.replace('\n', ' ').strip()
                row_data.append(cell_text)
            table_data.append(row_data)
        tables.append(pd.DataFrame(table_data))
    
    return tables

def save_tables_to_csv(tables, output_folder, base_name):
    """Save each table as a CSV file."""
    os.makedirs(output_folder, exist_ok=True)
    saved_files = []

    for i, table in enumerate(tables, 1):
        csv_filename = os.path.join(output_folder, f"{base_name}_table_{i}.csv")
        table.to_csv(csv_filename, index=False, header=False, encoding='utf-8-sig', escapechar='\\')
        saved_files.append(csv_filename)
    
    return saved_files

def main():
    docx_path = input("Enter path to the .docx file: ").strip()

    if not docx_path.lower().endswith(".docx") or not os.path.exists(docx_path):
        print("‚ùå Please provide a valid .docx file path.")
        return

    base_name = Path(docx_path).stem
    output_dir = os.path.join("extracted_tables", base_name)

    print(f"üîç Extracting tables from: {docx_path}")
    tables = extract_tables_from_docx(docx_path)

    if not tables:
        print("‚ö† No tables found in the document.")
        return

    saved_files = save_tables_to_csv(tables, output_dir, base_name)
    print(f"‚úÖ Extracted {len(saved_files)} tables. Files saved in: {output_dir}")

if __name__ == "__main__":
    main()
