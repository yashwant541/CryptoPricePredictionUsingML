import PyPDF2
from docx import Document
import pandas as pd
import sys

def extract_tables_from_pdf(pdf_path):
    """Extract tables from a PDF file"""
    tables = []
    with open(pdf_path, 'rb') as file:
        reader = PyPDF2.PdfReader(file)
        
        for page_num in range(len(reader.pages)):
            page = reader.pages[page_num]
            text = page.extract_text()
            
            # Simple table detection - looks for text with consistent spacing
            lines = text.split('\n')
            
            # Check if we have at least 2 lines with similar spacing (potential table)
            if len(lines) >= 2:
                # Simple heuristic: if multiple lines have the same number of 'spaces' in similar positions
                tables.append(f"Table found on page {page_num + 1}:\n" + "\n".join(lines[:10]) + "\n...")
    
    if not tables:
        return ["No tables detected in PDF (note: simple text extraction may miss complex tables)"]
    return tables

def extract_tables_from_docx(docx_path):
    """Extract tables from a Word document"""
    doc = Document(docx_path)
    tables = []
    
    for i, table in enumerate(doc.tables):
        table_data = []
        
        for row in table.rows:
            row_data = []
            for cell in row.cells:
                row_data.append(cell.text.strip())
            table_data.append(row_data)
        
        # Convert to pandas DataFrame for better display
        df = pd.DataFrame(table_data)
        tables.append(f"Table {i + 1}:\n{df.to_string(index=False, header=False)}\n")
    
    if not tables:
        return ["No tables found in Word document"]
    return tables

def get_file_type(prompt):
    """Helper function to get file type with validation"""
    while True:
        file_type = input(prompt).lower().strip()
        if file_type in ['docx', 'pdf']:
            return file_type
        print("Invalid input. Please enter 'docx' or 'pdf'.")

def main():
    print("Table Extraction Tool")
    print("---------------------\n")
    
    # Get file paths and types
    file1_path = input("Enter path to first file: ").strip()
    file1_type = get_file_type(f"What type is {file1_path}? Enter 'docx' or 'pdf': ")
    
    file2_path = input("Enter path to second file: ").strip()
    file2_type = get_file_type(f"What type is {file2_path}? Enter 'docx' or 'pdf': ")
    
    # Process files
    print("\nProcessing files...\n")
    
    files = [
        (file1_path, file1_type),
        (file2_path, file2_type)
    ]
    
    for i, (file_path, file_type) in enumerate(files, 1):
        print(f"=== Results for File {i}: {file_path} ({file_type.upper()}) ===")
        
        try:
            if file_type == 'docx':
                tables = extract_tables_from_docx(file_path)
            else:
                tables = extract_tables_from_pdf(file_path)
            
            for table in tables:
                print(table)
                print("-" * 50)
                
        except FileNotFoundError:
            print(f"Error: File not found at {file_path}")
        except Exception as e:
            print(f"Error processing {file_path}: {str(e)}")
        
        print("\n")

if __name__ == "__main__":
    main()
