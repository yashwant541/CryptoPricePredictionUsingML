import dataiku

dataset = dataiku.Dataset("your_dataset_name")
df = dataset.get_dataframe()

project = dataiku.api_client().get_project(dataiku.default_project_key())

sender = "your_email@company.com"

for _, row in df.iterrows():
    name = row["name"]
    email = row["email"]
    metric = row["metric"]

    html_body = f"""
    <!DOCTYPE html>
    <html>
    <body>
      <div style="font-family: Arial, sans-serif;">
        <h2>Hello {name},</h2>

        <p>Your latest score is <strong>{metric}</strong>.</p>

        <a href="https://your-link.com"
           style="padding:12px 18px;
                  background:#1f77b4;
                  color:#fff;
                  text-decoration:none;
                  border-radius:4px;">
          View Details
        </a>

        <p style="font-size:12px;color:#888;margin-top:30px;">
          Automated email sent from Dataiku
        </p>
      </div>
    </body>
    </html>
    """

    project.send_email(
        sender=sender,
        to=[email],
        subject=f"Hello {name} â€“ Your Update",
        message=html_body,
        mime_type="text/html"
    )
