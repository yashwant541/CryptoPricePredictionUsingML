# Import Dataiku and pandas
import dataiku
import pandas as pd

# Load the datasets
new_data = dataiku.Dataset("new_data").get_dataframe()
try:
    # Load the master log dataset if it exists
    master_log = dataiku.Dataset("master_log").get_dataframe()
except:
    # If master_log doesn't exist yet, create an empty DataFrame
    master_log = pd.DataFrame(columns=["Name"])

# Specify the column containing the names
name_column = "Name"

# Get unique names from both datasets
new_names = set(new_data[name_column].unique())
existing_names = set(master_log[name_column].unique())

# Find new unique names that are not in the master log
unique_new_names = list(new_names - existing_names)

# Append new names to the master log
if unique_new_names:
    new_entries = pd.DataFrame(unique_new_names, columns=[name_column])
    updated_master_log = pd.concat([master_log, new_entries], ignore_index=True)
else:
    updated_master_log = master_log

# Write the updated master log back to the dataset
output = dataiku.Dataset("master_log")
output.write_with_schema(updated_master_log)
